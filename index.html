<!-- Publications -->
<section class="resume-section" id="publications">
  <div class="resume-section-content">
    <h2 class="mb-3">Publications</h2>
    <p class="text-muted" style="margin-top:-10px">Auto-formatted to match Google Scholar style · showing items from 2023 onwards</p>

    <!-- Optional quick filters -->
    <div class="mb-3" id="pub-filters" style="display:flex;gap:10px;align-items:center;">
      <button class="btn btn-sm btn-outline-primary" data-year="all">All (2023+)</button>
      <button class="btn btn-sm btn-outline-secondary" data-year="2025">2025</button>
      <button class="btn btn-sm btn-outline-secondary" data-year="2024">2024</button>
      <button class="btn btn-sm btn-outline-secondary" data-year="2023">2023</button>
    </div>

    <ul class="list-group" id="pub-list" aria-live="polite"></ul>

    <div id="pub-error" class="text-danger mt-3" style="display:none;">
      Couldn’t load publications. If you’re viewing this locally via file:// please use a local server or deploy to the web.
    </div>
  </div>
</section>

<script>
/**
 * EXPECTED JSON at: /data/publications.json
 * [
 *   {
 *     "title": "...",
 *     "authors": ["Last, F.", "Last, F.M.", "..."],
 *     "venue": "Journal / Conference",
 *     "volume": "10",
 *     "issue": "2",
 *     "pages": "114-127",
 *     "year": 2024,
 *     "doi": "10.1038/s41537-024-00524-7",
 *     "url": "https://doi.org/10.1038/s41537-024-00524-7"
 *   },
 *   ...
 * ]
 */

(function() {
  const LIST_EL = document.getElementById('pub-list');
  const ERR_EL  = document.getElementById('pub-error');
  const FILTERS = document.getElementById('pub-filters');

  const START_YEAR = 2023;
  const DATA_URL   = 'data/publications.json'; // put the JSON here in your repo

  function scholarCitation(pub) {
    // Build a citation that looks like Google Scholar's list style
    // Example: A Author, B Author, ...  Title.  Venue volume(issue), pages, year.
    const authors = (pub.authors || []).join(', ');

    // Venue chunk (handles missing bits gracefully)
    let venueChunk = (pub.venue || '').trim();
    if (pub.volume) venueChunk += ` ${pub.volume}`;
    if (pub.issue)  venueChunk += `(${pub.issue})`;
    if (pub.pages)  venueChunk += `, ${pub.pages}`;
    if (pub.year)   venueChunk += `, ${pub.year}`;

    // Link to DOI/URL if present
    let linkHTML = '';
    if (pub.url) {
      const nice = pub.doi ? `DOI: ${pub.doi}` : 'Link';
      linkHTML = ` <a href="${pub.url}" target="_blank" rel="noopener">${nice}</a>`;
    } else if (pub.doi) {
      linkHTML = ` <a href="https://doi.org/${pub.doi}" target="_blank" rel="noopener">DOI: ${pub.doi}</a>`;
    }

    return `
      <li class="list-group-item">
        <div style="font-size:0.95rem; line-height:1.4;">
          <span>${authors}.</span>
          <br>
          <strong>${pub.title || ''}</strong>
          <br>
          <em>${venueChunk}</em>${linkHTML}
        </div>
      </li>
    `;
  }

  function render(list, yearFilter = 'all') {
    LIST_EL.innerHTML = '';
    const filtered = list
      .filter(p => (p.year && p.year >= START_YEAR))
      .filter(p => (yearFilter === 'all' ? true : p.year === Number(yearFilter)))
      .sort((a,b) => (b.year - a.year) || (a.title||'').localeCompare(b.title||''));

    if (!filtered.length) {
      LIST_EL.innerHTML = '<li class="list-group-item text-muted">No items match this filter.</li>';
      return;
    }

    LIST_EL.innerHTML = filtered.map(scholarCitation).join('');
  }

  fetch(DATA_URL, {cache: 'no-store'})
    .then(r => r.json())
    .then(data => { render(data, 'all'); })
    .catch(err => { console.error(err); ERR_EL.style.display = 'block'; });

  // Filters
  FILTERS.addEventListener('click', (e) => {
    if (!(e.target instanceof HTMLElement)) return;
    const yr = e.target.getAttribute('data-year');
    if (!yr) return;
    // toggle button styles
    Array.from(FILTERS.querySelectorAll('button')).forEach(b => {
      b.classList.remove('btn-primary');
      b.classList.add('btn-outline-secondary');
    });
    e.target.classList.remove('btn-outline-secondary');
    e.target.classList.add('btn-primary');

    // Re-fetch then filter (keeps it simple and stateless)
    fetch(DATA_URL, {cache: 'no-store'})
      .then(r => r.json())
      .then(data => render(data, yr))
      .catch(err => { console.error(err); ERR_EL.style.display = 'block'; });
  });
})();
</script>
